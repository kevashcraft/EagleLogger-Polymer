<dom-module id="elp-login">
<style>
	:host {
		display: block;
	}
	paper-button {
		margin-top: 20px;
	}
	paper-dialog paper-icon-button[icon="close"] {
		position: absolute;
		top: -5px;
		right: 0;
	}
</style>
<template>
	<paper-dialog entry-animation="scale-up-animation" id="login" no-cancel-on-outside-click no-cancel-on-esc-key>
		<h2>Login/Register</h2>
		<paper-input label="Callsign" value="{{callsign}}" autofocus></paper-input>
		<paper-input label="Password" value="{{password}}" type="password"></paper-input>
		<div style="text-align: center">
			<paper-button on-tap="login" raised>Login</paper-button>
			<paper-icon-button icon="help" on-tap="helpMe" style="position: absolute; left: 0; bottom: 5px"></paper-icon-button>
		</div>
	</paper-dialog>

	<paper-dialog id="help">
		<h2>How to register</h2>
		<paper-icon-button icon="close" dialog-dismiss></paper-icon-button>
		<p style="font-size: 21px">
			If you've never logged in before,<br>
			enter your callsign and the password that you want<br>
			in the login box and a new account will be created for you.
		</p>
	</paper-dialog>
	<iron-ajax on-response="jaxsonResponse" id="jaxson"></iron-ajax>
</template>
</dom-module>
<script>
	Polymer({
		is: 'elp-login',
		behaviors: [
			Polymer.ELBehavior,
		],
		properties: {
			info: {
				type: Object,
				value: {
					title: 'Login',
					url: '/login'
				}
			},
			callsign: {
				type: String,
				observer: '_callsignChanged'
			}
		},
		ready: function() {
			setTimeout(function(){
				this.$.login.open();
				this.$.login.addEventListener('keypress', function(event) { if(event.keyCode == 13) this.login() }.bind(this));
			}.bind(this), 250);

		},
		helpMe: function() {
			this.$.help.open();
		},
		login: function() {
			this.jaxson('users/login',{
				callsign: this.callsign,
				password: this.password
			});
		},
		_callsignChanged: function(callsign) {
			this.callsign = callsign.toUpperCase();
		},
		_jaxson: function(r) {
			console.log("r.user",r.user);
			if(r.user.token) {
				el.user = r.user;
				el.setPage('dashboard', 'push');
			}
		},
	});
</script>