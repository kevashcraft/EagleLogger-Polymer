<script>
Polymer.ELRouter = {
	pages: {
		login: 'elp-login',
		net: 'elp-net',
		nets: 'elp-nets',
		callsigns: 'elp-callsigns',
	},
	router: function() {
		var location = window.location.pathname.split('/');
		var page = location[1].toLowerCase();
		this.setPage(false, 1);
		this._statelyListen();
	},
	setPage: function(location, replace) {

		var action = replace ? 'replace' : 'push'

		this.header = '';

		if(this.ce && this.ce.sse) this.ce.sse.close();

		this.searchDisable();

		var page = this._page(location);

		var elem = this.ce = document.createElement(page);

		if(elem.vertMenu) {
			this.vertMenu = elem.vertMenu;
			this.vertMenuHidden = false;
		} else {
			this.vertMenuHidden = true;
		}

		url = '/' + this.location.join('/');

		if (url == '//') url = '/';

		this._stately({
			element: page,
			title: elem.info.title,
			url: url,
			location: this.location,
			header: elem.info.header
		}, action, elem);

	},
	_stately: function(o, action, elem) {
		if(action == 'pop') {
			this.location = o.location;
			var elem = this.ce = document.createElement(o.element);
		}

		if(action == 'push')
			window.history.pushState(o, o.title, o.url);
		else if(action == 'replace')
			window.history.replaceState(o, o.title, o.url);

		this.header = o.header;

		this.$.content.innerHTML = '';

		this.$.content.appendChild(elem);

		document.title = o.title + " | Eagle Logger";

		if(!elem.customHighlight)
			this.menuHighlighter();

	},
	_statelyListen: function() {
		window.addEventListener('popstate', function(e){
			this._stately(e.state, 'pop');
		}.bind(this));
	},
	_page: function(location) {

		var location = this._location(location);

		// Define first level page
		var page = this.pages[location[0]] || '';

		// Find the page 
		for(var i = 1; i < location.length; i++) {
			if(typeof page != 'string' && typeof page[location[i]] != 'undefined')
				page = page[location[i]];
			else
				break;
		}

		// set the page if it's a string
		if(typeof page != 'string') page = '';

		// Default is dashboard
		if(page == '') page = 'elp-dashboard';

		// Unauthed default is login page
		if(!this.authed && page == 'elp-dashboard') page = 'elp-home';

		// If authed and trying to go to login, go to dashboard
		if(this.authed && page == 'elp-login')
			page = 'elp-dashboard';

		if(page == 'elp-dashboard' || page == 'elp-login')
			this._location([page.substr(4)]);

		return page;
	},
	_location: function(location) {

		// Grab the location - removes first (and last) slash, lowercase it, then convert to array
		if(!location)
			var location = window.location.pathname.substr(1).replace(/\/$/,'').toLowerCase().split('/');

		if(location[0] == 'home')
			location = [''];

		// Set the stored location
		this.location = location;
		return location;
	},
}
</script>