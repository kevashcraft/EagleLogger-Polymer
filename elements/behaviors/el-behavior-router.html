<script>
Polymer.ELBehaviorRouter = {
	// define the pages
	pages: {
		test: 'el-test',
		login: 'elp-login',
		net: 'elp-net',
		nets: 'elp-nets',
		callsigns: 'elp-callsigns',
	},
	// loads a page in the browser
	setPage: function(location, replace) {
		// determine the action
		var action = replace ? 'replace' : 'push'
		// reset the header
		this.header = '';
		// get the tag name of the location
		var page = this.__page(location);
		// create the element
		var elem = this.ce = document.createElement(page);
		// get the new url from location
		var url = '/';
		if(this.location.length > 0) url += this.location.join('/');
		// create new history event
		this._stately({
			element: page,
			title: elem.info.title,
			url: url,
			location: this.location,
		}, action, elem);
	},
	// initialize the router
	_router: function() {
		// load the page
		this.setPage(false, 1);
		// create push/pop listener
		this._statelyListen();
	},
	// handle push and pop events - actually loads the page data
	_stately: function(o, action, elem) {
		// when popped - back button pressed
		if(action == 'pop') {
			// set old location
			this.location = o.location;
			// get old element
			var elem = this.ce = document.createElement(o.element);
		}
		// when pushed - manually
		if(action == 'push')
			// push it
			window.history.pushState(o, o.title, o.url);
		else if(action == 'replace') // or replaced - manually
			// replace it
			window.history.replaceState(o, o.title, o.url);

		// set the header and title
		this.header = o.title;
		document.title = o.title + " | Eagle Logger";

		// grab the content container
		var content = this.$.content;

		// remove a previous page
		if(content.children[0])
			content.children[0].animateOut();

		// add the new child
		content.appendChild(elem);

		// make it appear
		elem.animateIn();
	},
	// create the popstate event listener
	_statelyListen: function() {
		window.addEventListener('popstate', function(e){
			// call stately with new event
			this._stately(e.state, 'pop');
		}.bind(this));
	},
	// sets and returns the location array
	__location: function(location) {

		// Grab the location - removes first (and last) slash, lowercase it, then convert to array
		if(!location)
			var location = window.location.pathname.substr(1).replace(/\/$/,'').toLowerCase().split('/');

		// home page doesn't have a suburl
		if(location[0] == 'home')
			location = [''];

		// Set the stored location
		this.location = location;
		// return it
		return location;
	},
	// returns the best page found for the location
	__page: function(location) {
		// get the location
		var location = this.__location(location);

		// Define first level page, if none go home
		var page = this.pages[location[0]] || 'home';

		// Find the page by cycling through the location
		for(i in location) {
			// check the pages array for another level of arrays
			if(typeof page != 'string' && typeof page[location[i]] != 'undefined')
				page = page[location[i]];
			else // exit loop
				break;
		}

		// If authed and trying to go to login, go to dashboard
		if(this.authed && page == 'elp-login')
			page = 'elp-dashboard';

		// return the page
		return page;
	},
}
</script>